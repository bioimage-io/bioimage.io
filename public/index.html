<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/static/icons/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="RI-SCALE Model Hub - A community-driven, open resource for sharing standardized AI models across research infrastructures"
    />
    
    <!-- Cache busting meta tags -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="%PUBLIC_URL%/static/icons/apple-touch-icon.png" />
    
    <!-- Favicon Icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="%PUBLIC_URL%/static/icons/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="%PUBLIC_URL%/static/icons/favicon-16x16.png" />
    
    <!-- Microsoft Tile -->
    <meta name="msapplication-TileColor" content="#da532c" />
    <meta name="msapplication-config" content="%PUBLIC_URL%/static/icons/browserconfig.xml" />
    
    <!-- Safari Pinned Tab -->
    
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    
    <title>RI-SCALE Model Hub</title>
    
    <!-- Service Worker Cleanup -->
    <script>
      (function() {
        if ('serviceWorker' in navigator) {
          // Register the cleanup service worker that will unregister itself
          navigator.serviceWorker.register('/service-worker.js')
            .then(function(registration) {
              console.log('RI-SCALE Model Hub: Cleanup service worker registered');
              
              // If there's a waiting worker, activate it immediately
              if (registration.waiting) {
                registration.waiting.postMessage({ type: 'SKIP_WAITING' });
              }
              
              // Listen for updates
              registration.addEventListener('updatefound', function() {
                const newWorker = registration.installing;
                if (newWorker) {
                  newWorker.addEventListener('statechange', function() {
                    if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                      newWorker.postMessage({ type: 'SKIP_WAITING' });
                    }
                  });
                }
              });
            })
            .catch(function(error) {
              console.log('RI-SCALE Model Hub: Service worker registration failed:', error);
            });
          
          // Also clear caches manually as a backup
          if ('caches' in window) {
            caches.keys().then(function(cacheNames) {
              if (cacheNames.length > 0) {
                console.log('RI-SCALE Model Hub: Manual cache cleanup - found', cacheNames.length, 'cache(s)');
                Promise.all(
                  cacheNames.map(function(cacheName) {
                    return caches.delete(cacheName);
                  })
                ).then(function() {
                  console.log('RI-SCALE Model Hub: Manual cache cleanup complete');
                });
              }
            });
          }
        }
      })();
    </script>
    
    <!-- Matomo -->
    <script>
      var _paq = window._paq = window._paq || [];
      /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
      _paq.push(['trackPageView']);
      _paq.push(['enableLinkTracking']);
      (function() {
        var u="https://bioimage.matomo.cloud/";
        _paq.push(['setTrackerUrl', u+'matomo.php']);
        _paq.push(['setSiteId', '1']);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
        g.async=true; g.src='https://cdn.matomo.cloud/bioimage.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
      })();
    </script>
    <!-- End Matomo Code -->
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    <!--
      This HTML file is a template.
      If you open it directly in the browser, you will see an empty page.

      You can add webfonts, meta tags, or analytics to this file.
      The build step will place the bundled scripts into the <body> tag.

      To begin the development, run `npm start` or `yarn start`.
      To create a production bundle, use `npm run build` or `yarn build`.
    -->
  </body>
</html>
